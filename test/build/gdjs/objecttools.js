var gdjs;(function(l){let x;(function(O){let C;(function(g){g.pickOnly=function(n,t){for(const e in n.items)if(n.items.hasOwnProperty(e)){const s=n.items[e];s.indexOf(t)===-1?s.length=0:(s.length=0,s.push(t))}},g.twoListsTest=function(n,t,e,s,o){let f=!1;const i=l.staticArray(l.evtTools.object.twoListsTest);t.values(i);const u=l.staticArray2(l.evtTools.object.twoListsTest);e.values(u);for(let a=0,p=i.length;a<p;++a){let c=i[a];for(let r=0,h=c.length;r<h;++r)c[r].pick=!1}for(let a=0,p=u.length;a<p;++a){let c=u[a];for(let r=0,h=c.length;r<h;++r)c[r].pick=!1}for(let a=0,p=i.length;a<p;++a){const c=i[a];for(let r=0,h=c.length;r<h;++r){let T=!1;for(let j=0,y=u.length;j<y;++j){const m=u[j];for(let b=0,L=m.length;b<L;++b)c[r].pick&&m[b].pick||c[r].id!==m[b].id&&n(c[r],m[b],o)&&(s||(f=!0,c[r].pick=!0,m[b].pick=!0),T=!0)}!T&&s&&(f=!0,c[r].pick=!0)}}for(let a=0,p=i.length;a<p;++a){let c=i[a],r=0;for(let h=0,T=c.length;h<T;++h){let j=c[h];c[h].pick&&(c[r]=j,r++)}c.length=r}if(!s)for(let a=0,p=u.length;a<p;++a){let c=u[a],r=0;for(let h=0,T=c.length;h<T;++h){let j=c[h];c[h].pick&&(c[r]=j,r++)}c.length=r}return f},g.pickObjectsIf=function(n,t,e,s){let o=!1;const f=l.staticArray(l.evtTools.object.pickObjectsIf);t.values(f);for(let i=0,u=f.length;i<u;++i){const a=f[i];for(let p=0,c=a.length;p<c;++p){const r=a[p];e^n(r,s)?(o=!0,r.pick=!0):r.pick=!1}}for(let i=0,u=f.length;i<u;++i)l.evtTools.object.filterPickedObjectsList(f[i]);return o},g.filterPickedObjectsList=function(n){let t=0;for(let e=0,s=n.length;e<s;++e){const o=n[e];o.pick&&(n[t]=o,t++)}n.length=t},g.hitBoxesCollisionTest=function(n,t,e,s,o){return l.evtTools.object.twoListsTest(l.RuntimeObject.collisionTest,n,t,e,o)},g._distanceBetweenObjects=function(n,t,e){return n.getSqDistanceToObject(t)<=e},g.distanceTest=function(n,t,e,s){return l.evtTools.object.twoListsTest(l.evtTools.object._distanceBetweenObjects,n,t,s,e*e)},g._movesToward=function(n,t,e){if(n.hasNoForces())return!1;let s=Math.atan2(t.getDrawableY()+t.getCenterY()-(n.getDrawableY()+n.getCenterY()),t.getDrawableX()+t.getCenterX()-(n.getDrawableX()+n.getCenterX()));return s*=180/3.14159,Math.abs(l.evtTools.common.angleDifference(n.getAverageForce().getAngle(),s))<=e/2},g.movesTowardTest=function(n,t,e,s){return l.evtTools.object.twoListsTest(l.evtTools.object._movesToward,n,t,s,e)},g._turnedToward=function(n,t,e){let s=Math.atan2(t.getDrawableY()+t.getCenterY()-(n.getDrawableY()+n.getCenterY()),t.getDrawableX()+t.getCenterX()-(n.getDrawableX()+n.getCenterX()));return s*=180/3.14159,Math.abs(l.evtTools.common.angleDifference(n.getAngle(),s))<=e/2},g.turnedTowardTest=function(n,t,e,s){return l.evtTools.object.twoListsTest(l.evtTools.object._turnedToward,n,t,s,e)},g.pickAllObjects=function(n,t){for(const e in t.items)if(t.items.hasOwnProperty(e)){const s=n.getObjects(e),o=t.items[e];o.length=0,o.push.apply(o,s)}return!0},g.pickRandomObject=function(n,t){let e=0;for(let i in t.items)t.items.hasOwnProperty(i)&&(e+=t.items[i].length);if(e===0)return!1;let s=Math.floor(Math.random()*e);s>=e&&(s=e-1);let o=0,f=null;for(let i in t.items)if(t.items.hasOwnProperty(i)){let u=t.items[i];if(s-o<u.length){f=u[s-o];break}o+=u.length}return l.evtTools.object.pickOnly(t,f),!0},g.pickNearestObject=function(n,t,e,s){let o=null,f=0,i=!0;const u=l.staticArray(l.evtTools.object.pickNearestObject);n.values(u);for(let a=0,p=u.length;a<p;++a){const c=u[a];for(let r=0;r<c.length;++r){const h=c[r],T=h.getSqDistanceToPosition(t,e);(i||T<f^s)&&(f=T,o=h),i=!1}}return o?(l.evtTools.object.pickOnly(n,o),!0):!1},g.raycastObject=function(n,t,e,s,o,f,i,u){return l.evtTools.object.raycastObjectToPosition(n,t,e,t+o*Math.cos(s*Math.PI/180),e+o*Math.sin(s*Math.PI/180),f,i,u)},g.raycastObjectToPosition=function(n,t,e,s,o,f,i,u){let a=null,p=u?0:(s-t)*(s-t)+(o-e)*(o-e),c=0,r=0;const h=l.staticArray(l.evtTools.object.raycastObjectToPosition);n.values(h);for(let T=0;T<h.length;T++){const j=h[T];for(let y=0;y<j.length;y++){const m=j[y],b=m.raycastTest(t,e,s,o,!u);b.collision&&(!u&&b.closeSqDist<=p?(p=b.closeSqDist,a=m,c=b.closeX,r=b.closeY):u&&b.farSqDist>=p&&(p=b.farSqDist,a=m,c=b.farX,r=b.farY))}}return a?(l.evtTools.object.pickOnly(n,a),f.setNumber(c),i.setNumber(r),!0):!1},g.doCreateObjectOnScene=function(n,t,e,s,o,f){const i=n.createObject(t),u=n.getLayer(f);i!==null&&(i.setPosition(s,o),i.setLayer(f),i.setZOrder(u.getDefaultZOrder()),e.containsKey(t)&&e.get(t).push(i))},g.createObjectOnScene=function(n,t,e,s,o){l.evtTools.object.doCreateObjectOnScene(n,t.firstKey(),t,e,s,o)},g.createObjectFromGroupOnScene=function(n,t,e,s,o,f){l.evtTools.object.doCreateObjectOnScene(n,e,t,s,o,f)},g.getPickedInstancesCount=n=>{let t=0;const e=l.staticArray(l.evtTools.object.getPickedInstancesCount);n.values(e);for(let s=0,o=e.length;s<o;++s)t+=e[s].length;return t},g.getSceneInstancesCount=(n,t)=>{let e=0;const s=l.staticArray(l.evtTools.object.getSceneInstancesCount);t.keys(s);const o=new Set(s);for(const f of o)e+=n.getInstancesCountOnScene(f);return e},g.pickedObjectsCount=g.getPickedInstancesCount})(C=O.object||(O.object={}))})(x=l.evtTools||(l.evtTools={}));class w{constructor(){this.objectsLists=new Map;this.callbacks=new Map;this.parent=null}static from(O){const k=new w;return k.parent=O,k}getOrCreateList(O){return this.objectsLists.has(O)||this.objectsLists.set(O,[]),this.objectsLists.get(O)}getObjects(O){return!this.objectsLists.has(O)&&this.parent?this.parent.getObjects(O):this.objectsLists.get(O)||[]}addObject(O,k){const d=this.getOrCreateList(O);if(d.includes(k))return;d.push(k);const v=()=>this.removeObject(O,k);this.callbacks.set(k,v),k.registerDestroyCallback(v)}removeObject(O,k){const d=this.getOrCreateList(O),v=d.indexOf(k);v!==-1&&(d.splice(v,1),k.unregisterDestroyCallback(this.callbacks.get(k)),this.callbacks.delete(k))}}l.LongLivedObjectsList=w})(gdjs||(gdjs={}));
//# sourceMappingURL=objecttools.js.map
