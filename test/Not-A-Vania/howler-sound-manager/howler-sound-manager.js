var gdjs;(function(_){const p=new _.Logger("Audio manager"),w={preload:!0,onplayerror:(d,t)=>p.error("Can't play an audio file: "+t),onloaderror:(d,t)=>p.error("Error while loading an audio file: "+t)},c=d=>d>1?1:d<0?0:d;class y{constructor(t,e,s,o){this._id=null;this._oncePlay=[];this._onPlay=[];this._howl=t,this._initialVolume=c(e),this._loop=s,this._rate=o}isLoaded(){return this._howl.state()==="loaded"}play(){if(this.isLoaded()){const t=this._howl.play(this._id===null?"__default":this._id);this._id=t,this._howl.volume(this._initialVolume,t),this._howl.loop(this._loop,t),this._howl.rate(_.HowlerSoundManager.clampRate(this._rate),t),this._onPlay.forEach(e=>{this.on("play",e),e(t)}),this._oncePlay.forEach(e=>e(t)),this._onPlay=[],this._oncePlay=[]}else this._howl.once("load",()=>this.play());return this}pause(){return this._id!==null&&this._howl.pause(this._id),this}stop(){return this._id!==null&&this._howl.stop(this._id),this}playing(){return(this._id!==null?this._howl.playing(this._id):!0)||!this.isLoaded()}paused(){return!this.playing()}stopped(){return this.paused()&&this.getSeek()===0}getRate(){return this._rate}setRate(t){return this._rate=t,this._id!==null&&(t=_.HowlerSoundManager.clampRate(t),this._howl.rate(t,this._id)),this}getLoop(){return this._loop}setLoop(t){return this._loop=t,this._id!==null&&this._howl.loop(t,this._id),this}getVolume(){return this._id===null?this._initialVolume:this._howl.volume(this._id)}setVolume(t){return this._initialVolume=c(t),this._id!==null&&this._howl.volume(this._initialVolume,this._id),this}getMute(){return this._id===null?!1:this._howl.mute(this._id)}setMute(t){return this._id!==null&&this._howl.mute(t,this._id),this}getSeek(){return this._id===null?0:this._howl.seek(this._id)}setSeek(t){return this._id!==null&&this._howl.seek(t,this._id),this}getSpatialPosition(t){return this._id===null?0:this._howl.pos(this._id)[t==="x"?0:t==="y"?1:2]}setSpatialPosition(t,e,s){return this._id!==null&&this._howl.pos(t,e,s,this._id),this}fade(t,e,s){return this._id!==null&&this._howl.fade(c(t),c(e),s,this._id),this}on(t,e){return t==="play"?this._id===null?this._onPlay.push(e):this._howl.on(t,e,this._id):this._id===null?this.once("play",()=>this.on(t,e)):this._howl.on(t,e,this._id),this}once(t,e){return t==="play"?this._id===null?this._oncePlay.push(e):this.playing()?e(this._id):this._howl.once(t,e,this._id):this._id===null?this.once("play",()=>this.once(t,e)):this._howl.once(t,e,this._id),this}off(t,e){return this._id!==null&&this._howl.off(t,e,this._id),this}}_.HowlerSound=y;class g{constructor(t){this._loadedMusics={};this._loadedSounds={};this._availableResources={};this._globalVolume=100;this._sounds={};this._musics={};this._freeSounds=[];this._freeMusics=[];this._pausedSounds=[];this._paused=!1;this._resources=t;const e=this;document.addEventListener("deviceready",function(){document.addEventListener("pause",function(){const s=e._freeSounds.concat(e._freeMusics);for(let o in e._sounds)e._sounds.hasOwnProperty(o)&&s.push(e._sounds[o]);for(let o in e._musics)e._musics.hasOwnProperty(o)&&s.push(e._musics[o]);for(let o=0;o<s.length;o++){const i=s[o];!i.paused()&&!i.stopped()&&(i.pause(),e._pausedSounds.push(i))}e._paused=!0},!1),document.addEventListener("resume",function(){for(let s=0;s<e._pausedSounds.length;s++){const o=e._pausedSounds[s];o.stopped()||o.play()}e._pausedSounds.length=0,e._paused=!1},!1)})}setResources(t){this._resources=t}static clampRate(t){return t>4?4:t<.5?.5:t}_getFileFromSoundName(t){return this._availableResources.hasOwnProperty(t)&&this._availableResources[t].file?this._availableResources[t].file:t}_storeSoundInArray(t,e){for(let s=0,o=t.length;s<o;++s)if(t[s]!==null&&t[s].stopped())return t[s]=e,e;return t.push(e),e}createHowlerSound(t,e,s,o,i){const l=this._getFileFromSoundName(t),n=e?this._loadedMusics:this._loadedSounds;return n.hasOwnProperty(l)||(n[l]=new Howl(Object.assign({src:[l],html5:e,volume:0},w))),new _.HowlerSound(n[l],s,o,i)}loadAudio(t,e){const s=this._getFileFromSoundName(t),o=e?this._loadedMusics:this._loadedSounds;o.hasOwnProperty(s)||(o[s]=new Howl(Object.assign({src:[s],html5:e,volume:0},w)))}unloadAudio(t,e){const s=this._getFileFromSoundName(t),o=e?this._loadedMusics:this._loadedSounds;if(!o[s])return;const i=o[s];function l(n){for(let h in n)n[h]&&n[h]._howl===i&&(n[h].stop(),delete n[h])}l(this._freeMusics),l(this._freeSounds),l(Object.values(this._musics)),l(Object.values(this._sounds)),l(this._pausedSounds),o[s].unload(),delete o[s]}unloadAll(){Howler.unload(),this._freeSounds.length=0,this._freeMusics.length=0,this._sounds={},this._musics={},this._pausedSounds.length=0,this._loadedMusics={},this._loadedSounds={}}playSound(t,e,s,o){const i=this.createHowlerSound(t,!1,s/100,e,o);this._storeSoundInArray(this._freeSounds,i),i.once("play",()=>{this._paused&&(i.pause(),this._pausedSounds.push(i))}),i.play()}playSoundOnChannel(t,e,s,o,i){this._sounds[e]&&this._sounds[e].stop();const l=this.createHowlerSound(t,!1,o/100,s,i);this._sounds[e]=l,l.once("play",()=>{this._paused&&(l.pause(),this._pausedSounds.push(l))}),l.play()}getSoundOnChannel(t){return this._sounds[t]||null}playMusic(t,e,s,o){const i=this.createHowlerSound(t,!0,s/100,e,o);this._storeSoundInArray(this._freeMusics,i),i.once("play",()=>{this._paused&&(i.pause(),this._pausedSounds.push(i))}),i.play()}playMusicOnChannel(t,e,s,o,i){this._musics[e]&&this._musics[e].stop();const l=this.createHowlerSound(t,!0,o/100,s,i);this._musics[e]=l,l.once("play",()=>{this._paused&&(l.pause(),this._pausedSounds.push(l))}),l.play()}getMusicOnChannel(t){return this._musics[t]||null}setGlobalVolume(t){this._globalVolume=t,this._globalVolume>100&&(this._globalVolume=100),this._globalVolume<0&&(this._globalVolume=0),Howler.volume(this._globalVolume/100)}getGlobalVolume(){return this._globalVolume}clearAll(){Howler.stop(),this._freeSounds.length=0,this._freeMusics.length=0,this._sounds={},this._musics={},this._pausedSounds.length=0}preloadAudio(t,e,s){s=s||this._resources;const o={};for(let a=0,u=s.length;a<u;++a){let r=s[a];if(r.file&&r.kind==="audio"){if(this._availableResources[r.name])continue;this._availableResources[r.name]=r,o[r.file]=(o[r.file]||[]).concat(r)}}const i=Object.keys(o).length;if(i===0)return e(i);let l=0;const n=(a,u)=>{if(u&&p.warn("There was an error while preloading an audio file: "+u),l++,l===i)return e(i);t(l,i)},h=(a,u,r)=>{const f=r?this._loadedMusics:this._loadedSounds;f[a]=new Howl(Object.assign({},w,{src:[a],onload:u,onloaderror:u,html5:r,volume:0}))};for(let a in o)if(o.hasOwnProperty(a)){const u=o[a][0];if(!u.preloadAsSound&&!u.preloadAsMusic)n();else if(u.preloadAsSound&&u.preloadAsMusic){let r=!1;const f=(S,m)=>{if(!r){r=!0;return}n(S,m)};h(a,f,!0),h(a,f,!1)}else u.preloadAsSound?h(a,n,!1):u.preloadAsMusic&&h(a,n,!0)}}}_.HowlerSoundManager=g,_.SoundManager=g})(gdjs||(gdjs={}));
//# sourceMappingURL=howler-sound-manager.js.map
